---
  # - include: handlers/linux_handlers.yml
  #   when: squad_server_os == 'linux'
  #
  # - include: handlers/windows_handlers.yml
  #   when: squad_server_os == 'windows'

  - name: download galaxy roles
    command: ansible-galaxy install -r requirements.yml --force -p roles/
    args:
      chdir: ./roles/squad/
      creates: ./roles/squad/roles
    delegate_to: localhost

  - name: Include WinRM variables for windows os
    include_vars:
      file: winrm.yml
    when: squad_server_os == 'windows'

  - name: Wait for linux host to become ready
    include: linux_wait.yml
    when: squad_server_os == 'linux'

  - name: Wait for windows host to become ready
    include: windows_wait.yml
    when: squad_server_os == 'windows'

  - name: Install dependencies
    include: linux_dependencies.yml
    when: squad_server_os == 'linux'

  - name: Ensure Chocolatey is installed
    include_role:
      name: chocolatey
    when: squad_server_os == 'windows'

  - name: Install dependencies
    include: windows_dependencies.yml
    when: squad_server_os == 'windows'

  - name: Gather facts
    setup:

  - name: debug the OPERATING SYSTEM
    debug:
      var: squad_server_os

  - name: Install Steamcmd
    include_role:
      name: steamcmd
    when: squad_server_os == 'linux'

  - name: Install Squad
    include: linux_install_squad.yml
    when: squad_server_os == 'linux'

  - name: Install Mods
    include: linux_install_mods.yml
    when: squad_server_os == 'linux'

  - name: Configure Squad system service
    include: linux_install_service.yml
    when: squad_server_os == 'linux'

  - name: Provision Windows with Squad software and other tools
    include: windows_install_squad.yml
    when: squad_server_os == 'windows'

  - name: Add Windows Firewall Exceptions
    include: windows_firewall.yml
    when: squad_server_os == 'windows'

  - name: Set up Squad Server Watchdog
    include: windows_watchdog.yml
    when: squad_server_os == 'windows'
